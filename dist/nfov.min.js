!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.nfov=e():t.nfov=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e,n){"use strict";var i=function t(e,n,i,r){t.each(n,function(n){var o=t.agent(e,n);t.each(i,function(i){var a=t.target(e,i);t.targetInRange(e,o,a)&&t.targetInFOV(e,o,a)&&t.targetIsVisible(e,o,a)&&r(n,i)})})};i.each=function(t,e){Array.isArray(t)?t.forEach(function(t){i.each(t,e)}):e(t)},i.fixPrecision=function(t){var e=1e10;return Math.round(t*e)/e},i.parseAngle=function(t,e,n){return t=!0===e?t*Math.PI/180:t,t=t>=0?t:t+2*Math.PI,t=!0===n&&t>0?2*Math.PI-t:t},i.basicObject=function(t,e){if(null==e.x&&null==e.position)throw new Error("Object position not found");var n={x:e.x,y:e.y},i={width:e.width,height:e.height},r={x:.5,y:.5};return null!=e.position&&(n.x=e.position.x,n.y=e.position.y),null!=e.body&&null!=e.body.width&&(i.width=e.body.width,i.height=e.body.height),null!=e.anchor&&(r.x=0,r.y=0),{origin:{x:n.x+i.width*r.x,y:n.y+i.height*r.y}}},i.agent=function(t,e){var n=i.basicObject(t,e);return n.distance=t.getDistance(),n.direction=0,n.maxAngle=t.getAngle(t.RADIANS),null!=e.distance&&(n.distance=e.distance),null!=e.direction?n.direction=i.parseAngle(e.direction,t.getAngleUnit()===t.DEGREES,t.getOrientation()===t.CLOCKWISE):null!=e.body&&null!=e.body.rotation?n.direction=i.parseAngle(e.body.rotation,!0,!0):null!=e.body&&null!=e.body.angle?n.direction=i.parseAngle(e.body.angle,!1,!0):null!=e.rotation&&(n.direction=i.parseAngle(e.rotation,t.getAngleUnit()===t.DEGREES,t.getOrientation()===t.CLOCKWISE)),null!=e.maxAngle&&(n.maxAngle=t.getAngleUnit()===t.DEGREES?e.maxAngle*Math.PI/180:e.maxAngle),n},i.target=function(t,e){return i.basicObject(t,e)},i.angleDiff=function(t,e){var n=Math.PI,i=2*n,r=t-e;return r%=i,r>=n?r-=i:r<-n&&(r+=i),r},i.makeRay=function(t,e,n){var i={x:t.x/n.width,y:t.y/n.height},r={x:e.x/n.width,y:e.y/n.height},o={x:r.x-i.x,y:r.y-i.y},a={x:0===o.x?0:Math.abs(1/o.x),y:0===o.y?0:Math.abs(1/o.y)},l={x:i.x-Math.floor(i.x),y:i.y-Math.floor(i.y)},s={x:0===o.x?2:(o.x>0?1-l.x:l.x)*a.x,y:0===o.y?2:(o.y>0?1-l.y:l.y)*a.y},u={x:o.x>=0?1:-1,y:o.y>=0?1:-1},c={x:Math.floor(i.x),y:Math.floor(i.y)};return{next:function(){return!(s.x>1&&s.y>1)&&(s.x<=s.y?(s.x+=a.x,c.x+=u.x):(s.y+=a.y,c.y+=u.y),{x:c.x,y:c.y})}}},i.targetInRange=function(t,e,n){if(e.distance>0){var i=n.origin.x-e.origin.x,r=e.origin.y-n.origin.y;return Math.sqrt(i*i+r*r)<=e.distance}return!0},i.targetInFOV=function(t,e,n){var r=Math.PI,o=2*r;if(e.maxAngle>0&&e.maxAngle<o){var a=Math.atan2(e.origin.y-n.origin.y,n.origin.x-e.origin.x),l=i.fixPrecision(i.angleDiff(e.direction,a)),s=i.fixPrecision(e.maxAngle/2);return l<=s&&l>=-s}return!0},i.targetIsVisible=function(t,e,n){var r=t.getGrid();if(null!=r)for(var o=t.getTileSize(),a=t.getAcceptableTiles(),l=i.makeRay(e.origin,n.origin,o),s=l.next();s;){if(null==r[s.y]||null==r[s.y][s.x])return!1;var u=r[s.y][s.x];if(!(a.indexOf(u)>=0))return!1;s=l.next()}return!0},t.exports=i},function(t,e,n){"use strict";function i(t){if(!(this instanceof i))throw new Error("Constructor called as a function");t=Object.assign({distance:0,angle:0,angleUnit:i.RADIANS,orientation:i.COUNTERCLOCKWISE,grid:null,tileSize:{width:1,height:1},acceptableTiles:[],handler:r},t),this.setDistance(t.distance),this.setAngle(t.angle),this.setAngleUnit(t.angleUnit),this.setOrientation(t.orientation),this.setGrid(t.grid),this.setTileSize(t.tileSize),this.setAcceptableTiles(t.acceptableTiles),this.setHandler(t.handler)}var r=n(0);i.RADIANS=i.prototype.RADIANS=1,i.DEGREES=i.prototype.DEGREES=2,i.CLOCKWISE=i.prototype.CLOCKWISE=1,i.COUNTERCLOCKWISE=i.prototype.COUNTERCLOCKWISE=2,i.prototype.setDistance=function(t){if(!("number"==typeof t&&t>=0))throw new Error("Invalid value passed for `distance`");this.distance=t},i.prototype.getDistance=function(){return this.distance},i.prototype.setAngle=function(t){if(!("number"==typeof t&&t>=0))throw new Error("Invalid value passed for `angle`");this.angle=t},i.prototype.getAngle=function(t){if(t===i.RADIANS){if(this.getAngleUnit()===i.DEGREES)return this.angle*Math.PI/180}else if(t===i.DEGREES&&this.getAngleUnit()===i.RADIANS)return 180*this.angle/Math.PI;return this.angle},i.prototype.setAngleUnit=function(t){if(t===i.RADIANS)this.angleUnit=i.RADIANS;else{if(t!==i.DEGREES)throw new Error("Invalid value passed for `angleUnit`");this.angleUnit=i.DEGREES}},i.prototype.getAngleUnit=function(){return this.angleUnit},i.prototype.setOrientation=function(t){if(t===i.CLOCKWISE)this.orientation=i.CLOCKWISE;else{if(t!==i.COUNTERCLOCKWISE)throw new Error("Invalid value passed for `orientation`");this.orientation=i.COUNTERCLOCKWISE}},i.prototype.getOrientation=function(){return this.orientation},i.prototype.setGrid=function(t){if(null!=t&&!Array.isArray(t))throw new Error("Invalid value passed for `grid`");this.grid=t},i.prototype.getGrid=function(){return this.grid},i.prototype.setTileSize=function(t,e){if(t>0)this.tileSize={width:t,height:e>0?e:t};else{if(!(null!=t&&t.width>0&&t.height>0))throw new Error("Invalid value passed for `tileSize`");this.tileSize={width:t.width,height:t.height}}},i.prototype.getTileSize=function(){return this.tileSize},i.prototype.setAcceptableTiles=function(t){if(Array.isArray(t))this.acceptableTiles=t.slice(0);else{if(null==t)throw new Error("Invalid value passed for `tiles`");this.acceptableTiles=[t]}},i.prototype.getAcceptableTiles=function(){return this.acceptableTiles},i.prototype.setHandler=function(t){if("function"!=typeof t)throw new Error("Invalid value passed for `handler`");this.handler=t},i.prototype.getHandler=function(){return this.handler},i.prototype.detect=function(t,e,n){this.getHandler()(this,t,e,n)},t.exports=i}])});
//# sourceMappingURL=nfov.min.js.map